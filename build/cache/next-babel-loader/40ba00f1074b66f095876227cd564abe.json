{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/home/kin/Desktop/ecom/frontend/src/contexts/Auth.context.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { useState, useContext, useEffect, memo } from \"react\";\nimport Router, { useRouter } from \"next/router\";\nimport api from \"services/axios\";\nvar AuthContext = /*#__PURE__*/React.createContext({});\n\nfunction AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n  console.log(\"authprovider chay\");\n\n  var _useState = useState(null),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(true),\n      loading = _useState2[0],\n      setLoading = _useState2[1];\n\n  useEffect(function () {\n    console.log(\"useEffect chay\");\n\n    function loadUserFromCookies() {\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    function _loadUserFromCookies() {\n      _loadUserFromCookies = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var user;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                user = localStorage.getItem(\"userInfo\");\n                if (user) setUser(JSON.parse(user)); //Use can check user by request to server with autocookie send in request\n\n                setLoading(false);\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    loadUserFromCookies();\n    return function () {\n      return console.log(\"re-mount auth contexnt\");\n    };\n  }, []);\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n      var _yield$api$post, _user;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return api.post(\"api/auth/login\", {\n                email: email,\n                password: password\n              });\n\n            case 3:\n              _yield$api$post = _context2.sent;\n              _user = _yield$api$post.data.user;\n\n              if (!_user) {\n                _context2.next = 11;\n                break;\n              }\n\n              localStorage.setItem(\"userInfo\", JSON.stringify(_user));\n              _context2.next = 9;\n              return setUser(_user);\n\n            case 9:\n              _context2.next = 11;\n              return Router.push(\"/admin\");\n\n            case 11:\n              _context2.next = 16;\n              break;\n\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](0);\n              return _context2.abrupt(\"return\", console.error(_context2.t0.response));\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 13]]);\n    }));\n\n    return function login(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var logout = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              localStorage.removeItem(\"userInfo\");\n              _context3.next = 3;\n              return api.post(\"auth/logout\");\n\n            case 3:\n              setUser(null);\n              _context3.next = 6;\n              return Router.push(\"/login\");\n\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function logout() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(AuthContext.Provider, {\n    value: {\n      isAuthenticated: !!user,\n      user: user,\n      login: login,\n      loading: loading,\n      logout: logout\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 5\n    }\n  }, children);\n}\n\n_s(AuthProvider, \"NiO5z6JIqzX62LS5UWDgIqbZYyY=\");\n\n_c = AuthProvider;\n\nfunction useAuth() {\n  _s2();\n\n  useContext(AuthContext);\n}\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nfunction ProtectRoute(_ref4) {\n  _s3();\n\n  var children = _ref4.children;\n\n  var _useContext = useContext(AuthContext),\n      isAuthenticated = _useContext.isAuthenticated,\n      loading = _useContext.loading;\n\n  var router = useRouter();\n\n  if (!isAuthenticated) {\n    // if(!loading) router.push(\"/login\");\n    // return <h1>Loading</h1>\n    if (true) {\n      console.log('chay vo day');\n      router.push(\"/login\"); // return;\n    }\n  }\n\n  return children;\n} // RedirectPage.getInitialProps = (ctx) => {\n//   // We check for ctx.res to make sure we're on the server.\n//   if (ctx.res) {\n//     ctx.res.writeHead(302, { Location: \"/new/url\" });\n//     ctx.res.end();\n//   }\n//   return {};\n// };\n\n\n_s3(ProtectRoute, \"bIL6h1fIp/aNDK+bGQNyVTDfuGY=\", false, function () {\n  return [useRouter];\n});\n\n_c2 = ProtectRoute;\nexport { AuthContext, AuthProvider, useAuth, ProtectRoute };\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"AuthProvider\");\n$RefreshReg$(_c2, \"ProtectRoute\");","map":{"version":3,"sources":["/home/kin/Desktop/ecom/frontend/src/contexts/Auth.context.js"],"names":["React","useState","useContext","useEffect","memo","Router","useRouter","api","AuthContext","createContext","AuthProvider","children","console","log","user","setUser","loading","setLoading","loadUserFromCookies","localStorage","getItem","JSON","parse","login","email","password","post","data","setItem","stringify","push","error","response","logout","removeItem","isAuthenticated","useAuth","ProtectRoute","router"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect, memo } from \"react\";\nimport Router, { useRouter } from \"next/router\";\n\nimport api from \"services/axios\";\n\nconst AuthContext = React.createContext({});\n\nfunction AuthProvider({ children }) {\n  console.log(\"authprovider chay\");\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    console.log(\"useEffect chay\");\n    async function loadUserFromCookies() {\n      const user = localStorage.getItem(\"userInfo\");\n      if (user) setUser(JSON.parse(user));\n      //Use can check user by request to server with autocookie send in request\n\n      setLoading(false);\n    }\n    loadUserFromCookies();\n    return () => console.log(\"re-mount auth contexnt\");\n  }, []);\n\n  const login = async (email, password) => {\n    try {\n      const {\n        data: { user },\n      } = await api.post(\"api/auth/login\", { email, password });\n      if (user) {\n        localStorage.setItem(\"userInfo\", JSON.stringify(user));\n        await setUser(user);\n        await Router.push(\"/admin\");\n      }\n    } catch (err) {\n      return console.error(err.response);\n    }\n  };\n\n  const logout = async () => {\n    localStorage.removeItem(\"userInfo\");\n    await api.post(\"auth/logout\");\n    setUser(null);\n    await Router.push(\"/login\");\n  };\n\n  return (\n    <AuthContext.Provider value={{ isAuthenticated: !!user, user, login, loading, logout }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nfunction useAuth() {\n  useContext(AuthContext);\n}\n\nfunction ProtectRoute({ children }) {\n  const { isAuthenticated, loading } = useContext(AuthContext);\n  const router = useRouter();\n  if (!isAuthenticated) {\n    // if(!loading) router.push(\"/login\");\n    // return <h1>Loading</h1>\n    if (typeof window !== \"undefined\") {\n      console.log('chay vo day')\n      router.push(\"/login\");\n      // return;\n    }\n  }\n\n  return children;\n}\n\n// RedirectPage.getInitialProps = (ctx) => {\n//   // We check for ctx.res to make sure we're on the server.\n//   if (ctx.res) {\n//     ctx.res.writeHead(302, { Location: \"/new/url\" });\n//     ctx.res.end();\n//   }\n//   return {};\n// };\n\nexport { AuthContext, AuthProvider, useAuth, ProtectRoute };\n"]},"metadata":{},"sourceType":"module"}