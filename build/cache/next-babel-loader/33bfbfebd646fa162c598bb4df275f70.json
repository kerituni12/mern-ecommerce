{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\nimport React, { useState, useContext, useEffect, memo } from \"react\";\nimport Router from \"next/router\";\nimport api from \"services/api\";\nvar AuthContext = /*#__PURE__*/React.createContext({});\n\nfunction AuthProvider(_ref) {\n  var children = _ref.children;\n  console.log(\"authprovider chay\");\n\n  var _useState = useState(null),\n      user = _useState[0],\n      setUser = _useState[1];\n\n  var _useState2 = useState(false),\n      isAuthenticated = _useState2[0],\n      setAuthenticated = _useState2[1];\n\n  var _useState3 = useState(true),\n      loading = _useState3[0],\n      setLoading = _useState3[1];\n\n  useEffect(function () {\n    console.log(\"useEffect chay\");\n\n    function loadUserFromCookies() {\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    function _loadUserFromCookies() {\n      _loadUserFromCookies = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var user;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                user = localStorage.getItem(\"userInfo\");\n                if (user) setUser(JSON.parse(user)); //Use can check user by request to server with autocookie send in request\n\n                setLoading(false);\n\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _loadUserFromCookies.apply(this, arguments);\n    }\n\n    loadUserFromCookies();\n  }, []);\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n      var _yield$api$post, _user;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return api.post(\"api/auth/login\", {\n                email: email,\n                password: password\n              });\n\n            case 3:\n              _yield$api$post = _context2.sent;\n              _user = _yield$api$post.data.user;\n\n              if (!_user) {\n                _context2.next = 11;\n                break;\n              }\n\n              localStorage.setItem(\"userInfo\", JSON.stringify(_user));\n              _context2.next = 9;\n              return setUser(_user);\n\n            case 9:\n              _context2.next = 11;\n              return Router.push(\"/admin\");\n\n            case 11:\n              _context2.next = 16;\n              break;\n\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](0);\n              return _context2.abrupt(\"return\", console.error(_context2.t0.response));\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 13]]);\n    }));\n\n    return function login(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var logout = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              localStorage.removeItem(\"userInfo\");\n              _context3.next = 3;\n              return api.post(\"auth/logout\");\n\n            case 3:\n              setUser(null);\n              _context3.next = 6;\n              return Router.push(\"/login\");\n\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function logout() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(AuthContext.Provider, {\n    value: {\n      isAuthenticated: !!user,\n      user: user,\n      login: login,\n      loading: loading,\n      logout: logout\n    }\n  }, children);\n}\n\nfunction useAuth() {\n  useContext(AuthContext);\n}\n\nfunction ProtectRoute(_ref4) {\n  var children = _ref4.children;\n\n  var _useContext = useContext(AuthContext),\n      isAuthenticated = _useContext.isAuthenticated,\n      loading = _useContext.loading;\n\n  if (!isAuthenticated) {\n    if (!loading) {\n      Router.push(\"/login\");\n    }\n\n    return __jsx(\"h1\", null, \"Loading\");\n  }\n\n  return children;\n}\n\nexport { AuthContext, AuthProvider, useAuth, ProtectRoute };","map":null,"metadata":{},"sourceType":"module"}